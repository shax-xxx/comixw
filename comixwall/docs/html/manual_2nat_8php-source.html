<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ComixWall ISG Administration Interface: View/pf/web/packetfilter/manual/nat.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_87b54b6b48ba0f3cd0b63254de503eea.html">View</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_eb995fb6d5f2e4ccd0094e4fc25f1cf9.html">pf</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_d48d15ebcc1431e49ee48bd5d118ed3c.html">web</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_63013e627e3b9ee515b8139c7b4dcfdc.html">packetfilter</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_b6c7959dc03ca4cad856d0a3aac19a18.html">manual</a></div>
<h1>nat.php</h1><a href="manual_2nat_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;h3 style=<span class="stringliteral">"text-align: center;"</span>&gt;Display manual <span class="keywordflow">for</span>:&lt;/h3&gt;
<a name="l00002"></a>00002 &lt;p style=<span class="stringliteral">"text-align: center;"</span>&gt;&amp;lt;
<a name="l00003"></a>00003   &lt;a onclick=<span class="stringliteral">"manual_showonly('basic');"</span>&gt;translation&lt;/a&gt;
<a name="l00004"></a>00004 | &lt;a onclick=<span class="stringliteral">"manual_showonly('pool');"</span>&gt;pool <a class="code" href="classoptions.html">options</a>&lt;/a&gt;
<a name="l00005"></a>00005 | &lt;a onclick=<span class="stringliteral">"manual_showonly('examples');"</span>&gt;examples&lt;/a&gt;
<a name="l00006"></a>00006 &amp;gt;&lt;/p&gt;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 &lt;<a class="code" href="classtable.html">table</a> <span class="keyword">class</span>=<span class="stringliteral">"manual"</span> <span class="keywordtype">id</span>=<span class="stringliteral">"basic"</span>&gt;
<a name="l00009"></a>00009   &lt;caption&gt;translation&lt;/caption&gt;
<a name="l00010"></a>00010   &lt;tr&gt;
<a name="l00011"></a>00011     &lt;th&gt;Statement&lt;/th&gt;
<a name="l00012"></a>00012     &lt;th&gt;Description&lt;/th&gt;
<a name="l00013"></a>00013   &lt;/tr&gt;
<a name="l00014"></a>00014   &lt;tr&gt;
<a name="l00015"></a>00015     &lt;td colspan=<span class="stringliteral">"2"</span>&gt;
<a name="l00016"></a>00016       &lt;p&gt;Translation <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a> modify either the source or destination address of the
<a name="l00017"></a>00017           packets associated with a stateful connection.  A stateful connection is
<a name="l00018"></a>00018           automatically created to track packets matching such a rule as <span class="keywordtype">long</span> as
<a name="l00019"></a>00019           they are not blocked by the filtering section of pf.conf.  The translation 
<a name="l00020"></a>00020           engine modifies the specified address and/or port in the packet, 
<a name="l00021"></a>00021           recalculates <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a>, TCP and UDP checksums as necessary, and passes it to the
<a name="l00022"></a>00022           packet <a class="code" href="classfilter.html">filter</a> <span class="keywordflow">for</span> evaluation.&lt;/p&gt;
<a name="l00023"></a>00023 
<a name="l00024"></a>00024       &lt;p&gt;Since translation occurs before filtering the <a class="code" href="classfilter.html">filter</a> engine will see
<a name="l00025"></a>00025           packets as they look after any addresses and ports have been translated.
<a name="l00026"></a>00026           Filter <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a> will therefore have to <a class="code" href="classfilter.html">filter</a> based on the translated ad-
<a name="l00027"></a>00027           dress and port number.  Packets that match a translation rule are only
<a name="l00028"></a>00028           automatically passed <span class="keywordflow">if</span> the pass modifier is given, otherwise they are
<a name="l00029"></a>00029           still subject to block and pass <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a>.&lt;/p&gt;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031       &lt;p&gt;The state entry created permits pf(4) to keep track of the original address 
<a name="l00032"></a>00032           for traffic associated with that state and correctly direct return
<a name="l00033"></a>00033           traffic for that connection.&lt;/p&gt;
<a name="l00034"></a>00034 
<a name="l00035"></a>00035       &lt;p&gt;Various types of translation are possible with pf:&lt;/p&gt;
<a name="l00036"></a>00036     &lt;/td&gt;
<a name="l00037"></a>00037   &lt;/tr&gt;
<a name="l00038"></a>00038   &lt;tr&gt;
<a name="l00039"></a>00039     &lt;td&gt;binat&lt;/td&gt;
<a name="l00040"></a>00040     &lt;td&gt;A binat rule specifies a bidirectional mapping between an external
<a name="l00041"></a>00041         <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a> netblock and an internal <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a> netblock.&lt;/td&gt;
<a name="l00042"></a>00042   &lt;/tr&gt;
<a name="l00043"></a>00043   &lt;tr&gt;
<a name="l00044"></a>00044     &lt;td&gt;<a class="code" href="classnat.html">nat</a>&lt;/td&gt;
<a name="l00045"></a>00045     &lt;td&gt;
<a name="l00046"></a>00046       &lt;p&gt;A <a class="code" href="classnat.html">nat</a> rule specifies that <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a> addresses are to be changed as the
<a name="l00047"></a>00047          packet traverses the given interface.  This technique allows one or
<a name="l00048"></a>00048          more <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a> addresses on the translating host to support network traffic 
<a name="l00049"></a>00049          for a larger range of machines on an "inside" network.  Although 
<a name="l00050"></a>00050          in theory any <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a> address can be used on the inside, it is
<a name="l00051"></a>00051          strongly recommended that one of the address ranges defined by RFC
<a name="l00052"></a>00052          1918 be used.  These netblocks are:&lt;/p&gt;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054            &lt;code&gt;10.0.0.0 - 10.255.255.255 (all of net 10, i.e., 10/8)&lt;/code&gt;&lt;br /&gt;
<a name="l00055"></a>00055            &lt;code&gt;172.16.0.0 - 172.31.255.255 (i.e., 172.16/12)&lt;/code&gt;&lt;br /&gt;
<a name="l00056"></a>00056            &lt;code&gt;192.168.0.0 - 192.168.255.255 (i.e., 192.168/16)&lt;/code&gt;
<a name="l00057"></a>00057     &lt;/td&gt;
<a name="l00058"></a>00058   &lt;/tr&gt;
<a name="l00059"></a>00059   &lt;tr&gt;
<a name="l00060"></a>00060     &lt;td&gt;rdr&lt;/td&gt;
<a name="l00061"></a>00061     &lt;td&gt;The packet is redirected to another destination and possibly a different 
<a name="l00062"></a>00062         port. rdr <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a> can optionally specify port ranges instead
<a name="l00063"></a>00063         of single ports.  rdr ... port 2000:2999 -&amp;gt; ... port 4000 redirects
<a name="l00064"></a>00064         ports 2000 to 2999 (inclusive) to port 4000.  rdr ... port
<a name="l00065"></a>00065         2000:2999 -&amp;gt; ... port 4000:* redirects port 2000 to 4000, 2001 to
<a name="l00066"></a>00066         4001, ..., 2999 to 4999.&lt;/td&gt;
<a name="l00067"></a>00067   &lt;/tr&gt;
<a name="l00068"></a>00068   &lt;tr&gt;
<a name="l00069"></a>00069     &lt;td colspan="2"&gt;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071       &lt;p&gt;In addition to modifying the address, some translation <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a> may modify
<a name="l00072"></a>00072          source or destination ports for tcp(4) or udp(4) connections; implicitly
<a name="l00073"></a>00073          in the case of <a class="code" href="classnat.html">nat</a> <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a> and explicitly in the case of rdr <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a>.  Port
<a name="l00074"></a>00074          numbers are never translated with a binat rule.&lt;/p&gt;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076       &lt;p&gt;For each packet processed by the translator, the translation <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a> are
<a name="l00077"></a>00077          evaluated in sequential order, from first to last.  The first matching
<a name="l00078"></a>00078          rule decides what <a class="code" href="commentedit_8php.html#a6e6ab6db051620fa9c4d60b3090ebd8">action</a> is taken.&lt;/p&gt;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080       &lt;p&gt;The no option prefixed to a translation rule causes packets to remain 
<a name="l00081"></a>00081          untranslated, much in the same way as drop quick works in the packet <a class="code" href="classfilter.html">filter</a>
<a name="l00082"></a>00082          (see below).  If no rule matches the packet it is passed to the <a class="code" href="classfilter.html">filter</a>
<a name="l00083"></a>00083          engine unmodified.&lt;/p&gt;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085       &lt;p&gt;Translation <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a> apply only to packets that pass through the specified
<a name="l00086"></a>00086          interface, and if no interface is specified, translation is applied to
<a name="l00087"></a>00087          packets on all interfaces.  For instance, redirecting port 80 on an 
<a name="l00088"></a>00088          external interface to an internal web server will only work for connections
<a name="l00089"></a>00089          originating from the outside.  Connections to the address of the external
<a name="l00090"></a>00090          interface from local hosts will not be redirected, since such packets do
<a name="l00091"></a>00091          not actually pass through the external interface.  Redirections cannot
<a name="l00092"></a>00092          reflect packets back through the interface they arrive on, they can only
<a name="l00093"></a>00093          be redirected to hosts connected to different interfaces or to the 
<a name="l00094"></a>00094          firewall itself.&lt;/p&gt;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096       &lt;p&gt;Note that redirecting external incoming connections to the loopback 
<a name="l00097"></a>00097          address, as in&lt;/p&gt;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099         &lt;code&gt;rdr on ne3 inet proto tcp to port 8025 -&amp;gt; 127.0.0.1 port 25&lt;/code&gt;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101       &lt;p&gt;will effectively allow an external host to connect to daemons bound 
<a name="l00102"></a>00102          solely to the loopback address, circumventing the traditional blocking of
<a name="l00103"></a>00103          such connections on a real interface.  Unless this effect is desired, any
<a name="l00104"></a>00104          of the local non-loopback addresses should be used as redirection target
<a name="l00105"></a>00105          instead, which allows external connections only to daemons bound to this
<a name="l00106"></a>00106          address or not bound to any address.&lt;/p&gt;
<a name="l00107"></a>00107     &lt;/td&gt;
<a name="l00108"></a>00108   &lt;/tr&gt;
<a name="l00109"></a>00109 &lt;/<a class="code" href="classtable.html">table</a>&gt;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 &lt;<a class="code" href="classtable.html">table</a> class="manual" <span class="keywordtype">id</span>="pool"&gt;
<a name="l00113"></a>00113   &lt;caption&gt;pool <a class="code" href="classoptions.html">options</a>&lt;/caption&gt;
<a name="l00114"></a>00114   &lt;tr&gt;
<a name="l00115"></a>00115     &lt;th&gt;Statement&lt;/th&gt;
<a name="l00116"></a>00116     &lt;th&gt;Description&lt;/th&gt;
<a name="l00117"></a>00117   &lt;/tr&gt;
<a name="l00118"></a>00118   &lt;tr&gt;
<a name="l00119"></a>00119     &lt;td colspan="2"&gt;
<a name="l00120"></a>00120       For <a class="code" href="classnat.html">nat</a> and rdr <a class="code" href="classrules.html" title="pfw&amp;#39;s parent rule class.">rules</a>, (as well as for the route-to, reply-to and dup-to
<a name="l00121"></a>00121       rule <a class="code" href="classoptions.html">options</a>) for which there is a single redirection address which has a
<a name="l00122"></a>00122       subnet mask smaller than 32 for IPv4 or 128 for IPv6 (more than one <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a>
<a name="l00123"></a>00123       address), a variety of different methods for assigning this address can
<a name="l00124"></a>00124       be used:
<a name="l00125"></a>00125     &lt;/td&gt;
<a name="l00126"></a>00126   &lt;/tr&gt;
<a name="l00127"></a>00127   &lt;tr&gt;
<a name="l00128"></a>00128     &lt;td nowrap="nowrap"&gt;bitmask&lt;/td&gt;
<a name="l00129"></a>00129     &lt;td&gt;The bitmask option applies the network portion of the redirection
<a name="l00130"></a>00130         address to the address to be modified (source with <a class="code" href="classnat.html">nat</a>, destination
<a name="l00131"></a>00131         with rdr).
<a name="l00132"></a>00132     &lt;/td&gt;
<a name="l00133"></a>00133   &lt;/tr&gt;
<a name="l00134"></a>00134   &lt;tr&gt;
<a name="l00135"></a>00135     &lt;td nowrap="nowrap"&gt;random&lt;/td&gt;
<a name="l00136"></a>00136     &lt;td&gt;The random option selects an address at random within the defined
<a name="l00137"></a>00137         block of addresses.
<a name="l00138"></a>00138     &lt;/td&gt;
<a name="l00139"></a>00139   &lt;/tr&gt;
<a name="l00140"></a>00140   &lt;tr&gt;
<a name="l00141"></a>00141     &lt;td nowrap="nowrap"&gt;source-hash&lt;/td&gt;
<a name="l00142"></a>00142     &lt;td&gt;The source-hash option uses a hash of the source address to determine 
<a name="l00143"></a>00143         the redirection address, ensuring that the redirection address
<a name="l00144"></a>00144         is always the same for a given source.  An optional key can be
<a name="l00145"></a>00145         specified after this keyword either in hex or as a <span class="keywordtype">string</span>; by default 
<a name="l00146"></a>00146         pfctl(8) randomly generates a key for source-hash every time
<a name="l00147"></a>00147         the ruleset is reloaded.
<a name="l00148"></a>00148     &lt;/td&gt;
<a name="l00149"></a>00149   &lt;/tr&gt;
<a name="l00150"></a>00150   &lt;tr&gt;
<a name="l00151"></a>00151     &lt;td nowrap="nowrap"&gt;round-robin&lt;/td&gt;
<a name="l00152"></a>00152     &lt;td&gt;&lt;p&gt;The round-robin option loops through the redirection address(es).&lt;/p&gt;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         &lt;p&gt;When more than one redirection address is specified, round-robin is
<a name="l00155"></a>00155            the only permitted pool type.&lt;/p&gt;
<a name="l00156"></a>00156     &lt;/td&gt;
<a name="l00157"></a>00157   &lt;/tr&gt;
<a name="l00158"></a>00158   &lt;tr&gt;
<a name="l00159"></a>00159     &lt;td nowrap="nowrap"&gt;static-port&lt;/td&gt;
<a name="l00160"></a>00160     &lt;td&gt;With nat rules, the static-port option prevents pf(4) from modifying
<a name="l00161"></a>00161         the source port on TCP and UDP packets.&lt;/td&gt;
<a name="l00162"></a>00162   &lt;/tr&gt;
<a name="l00163"></a>00163   &lt;tr&gt;
<a name="l00164"></a>00164     &lt;td colspan="2"&gt;
<a name="l00165"></a>00165      Additionally, the sticky-address option can be specified to help ensure
<a name="l00166"></a>00166      that multiple connections from the same source are mapped to the same
<a name="l00167"></a>00167      redirection address.  This option can be used with the random and round-
<a name="l00168"></a>00168      robin pool <a class="code" href="classoptions.html">options</a>.  Note that by default these associations are de-
<a name="l00169"></a>00169      stroyed as soon as there are no longer states which refer to them; in or-
<a name="l00170"></a>00170      der to make the mappings last beyond the lifetime of the states, increase
<a name="l00171"></a>00171      the global <a class="code" href="classoptions.html">options</a> with set timeout source-track See STATEFUL TRACKING
<a name="l00172"></a>00172      OPTIONS for more ways to control the source tracking.
<a name="l00173"></a>00173     &lt;/td&gt;
<a name="l00174"></a>00174   &lt;/tr&gt;
<a name="l00175"></a>00175 &lt;/<a class="code" href="classtable.html">table</a>&gt;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 &lt;<a class="code" href="classtable.html">table</a> class="manual" <span class="keywordtype">id</span>="examples"&gt;
<a name="l00180"></a>00180   &lt;caption&gt;examples&lt;/caption&gt;
<a name="l00181"></a>00181   &lt;tr&gt;
<a name="l00182"></a>00182     &lt;th&gt;Statement&lt;/th&gt;
<a name="l00183"></a>00183     &lt;th&gt;Description&lt;/th&gt;
<a name="l00184"></a>00184   &lt;/tr&gt;
<a name="l00185"></a>00185   &lt;tr&gt;
<a name="l00186"></a>00186     &lt;td colspan="2"&gt;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188       &lt;p&gt;This <a class="code" href="general_8php.html#98a89c9c47b78688607f80cbcda2a125">example</a> maps incoming requests on port 80 to port 8080, on which a
<a name="l00189"></a>00189          daemon is running (because, for <a class="code" href="general_8php.html#98a89c9c47b78688607f80cbcda2a125">example</a>, it is not run as root, and
<a name="l00190"></a>00190          therefore lacks permission to bind to port 80).&lt;/p&gt;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         &lt;code&gt;<span class="preprocessor"># use a macro for the interface name, so it can be changed easily&lt;/code&gt;&lt;br /&gt;</span>
<a name="l00193"></a>00193 <span class="preprocessor"></span>        &lt;code&gt;ext_if = <span class="stringliteral">"ne3"</span>&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195         &lt;code&gt;# map daemon on 8080 to appear to be on 80&lt;/code&gt;&lt;br /&gt;
<a name="l00196"></a>00196         &lt;code&gt;rdr on $ext_if proto tcp from any to any port 80 -&amp;gt; 127.0.0.1 port 8080&lt;/code&gt;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198     &lt;p&gt;If the pass modifier is given, packets matching the translation rule are
<a name="l00199"></a>00199        passed without inspecting the <a class="code" href="classfilter.html">filter</a> rules:&lt;/p&gt;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     &lt;code&gt;rdr pass on $ext_if proto tcp from any to any port 80 -&amp;gt; 127.0.0.1 \&lt;/code&gt;&lt;br /&gt;
<a name="l00202"></a>00202     &lt;code&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;port 8080&lt;/code&gt;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     &lt;p&gt;In the example below, vlan12 is configured as 192.168.168.1; the machine
<a name="l00205"></a>00205        translates all packets coming from 192.168.168.0/24 to 204.92.77.111 when
<a name="l00206"></a>00206        they are going out any interface except vlan12.  This has the net effect
<a name="l00207"></a>00207        of making traffic from the 192.168.168.0/24 network appear as though it
<a name="l00208"></a>00208        is the Internet routable address 204.92.77.111 to nodes behind any interface 
<a name="l00209"></a>00209        on the router except <span class="keywordflow">for</span> the nodes on vlan12.  (Thus, 192.168.168.1
<a name="l00210"></a>00210        can talk to the 192.168.168.0/24 nodes.)&lt;/p&gt;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212       &lt;code&gt;nat on ! vlan12 from 192.168.168.0/24 to any -&amp;gt; 204.92.77.111&lt;/code&gt;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214     &lt;p&gt;In the example below, the machine sits between a fake <span class="keyword">internal</span>
<a name="l00215"></a>00215        144.19.74.*  network, and a routable external <a class="code" href="defs_8php.html#16e3cb232d173c8a2ef726cc184d5c38">IP</a> of 204.92.77.100.  The
<a name="l00216"></a>00216        no nat rule excludes protocol AH from being translated.&lt;/p&gt;
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 &lt;pre&gt;
<a name="l00219"></a>00219 <span class="preprocessor"># NO NAT</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span>no nat on $ext_if proto ah from 144.19.74.0/24 to any
<a name="l00221"></a>00221 nat on $ext_if from 144.19.74.0/24 to any -&gt; 204.92.77.100
<a name="l00222"></a>00222 &lt;/pre&gt;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 &lt;p&gt;In the example below, packets bound <span class="keywordflow">for</span> one specific server, as well as
<a name="l00225"></a>00225 those generated by the sysadmins are not proxied; all other connections
<a name="l00226"></a>00226 are.&lt;/p&gt;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 &lt;pre&gt;
<a name="l00229"></a>00229 <span class="preprocessor"># NO RDR</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>no rdr on $int_if proto { tcp, udp } from any to $server port 80
<a name="l00231"></a>00231 no rdr on $int_if proto { tcp, udp } from $sysadmins to any port 80
<a name="l00232"></a>00232 rdr on $int_if proto { tcp, udp } from any to any port 80 -&gt; 127.0.0.1 \
<a name="l00233"></a>00233       port 80
<a name="l00234"></a>00234 &lt;/pre&gt;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 &lt;p&gt;This longer example uses both a NAT and a redirection.  The external interface 
<a name="l00237"></a>00237 has the address 157.161.48.183.  On the <span class="keyword">internal</span> interface, we
<a name="l00238"></a>00238 are running ftp-proxy(8), listening <span class="keywordflow">for</span> outbound ftp sessions captured to
<a name="l00239"></a>00239 port 8021.&lt;/p&gt;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 &lt;pre&gt;
<a name="l00242"></a>00242 <span class="preprocessor"># NAT</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span><span class="preprocessor"># Translate outgoing packets' source addresses (any protocol).</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span><span class="preprocessor"># In this case, any address but the gateway's external address is mapped.</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>nat on $ext_if inet from ! ($ext_if) to any -&gt; ($ext_if)
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="preprocessor"># NAT PROXYING</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span><span class="preprocessor"># Map outgoing packets' source port to an assigned proxy port instead of</span>
<a name="l00249"></a>00249 <span class="preprocessor"></span><span class="preprocessor"># an arbitrary port.</span>
<a name="l00250"></a>00250 <span class="preprocessor"></span><span class="preprocessor"># In this case, proxy outgoing isakmp with port 500 on the gateway.</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>nat on $ext_if inet proto udp from any port = isakmp to any -&gt; ($ext_if) \
<a name="l00252"></a>00252       port 500
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 # BINAT
<a name="l00255"></a>00255 # Translate outgoing packets' source address (any protocol).
<a name="l00256"></a>00256 # Translate incoming packets' destination address to an <span class="keyword">internal</span> machine
<a name="l00257"></a>00257 <span class="preprocessor"># (bidirectional).</span>
<a name="l00258"></a>00258 <span class="preprocessor"></span>binat on $ext_if from 10.1.2.150 to any -&gt; ($ext_if)
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 # RDR
<a name="l00261"></a>00261 # Translate incoming packets' destination addresses.
<a name="l00262"></a>00262 # As an example, redirect a TCP and UDP port to an <span class="keyword">internal</span> machine.
<a name="l00263"></a>00263 rdr on $ext_if inet proto tcp from any to ($ext_if) port 8080 \
<a name="l00264"></a>00264       -&gt; 10.1.2.151 port 22
<a name="l00265"></a>00265 rdr on $ext_if inet proto udp from any to ($ext_if) port 8080 \
<a name="l00266"></a>00266       -&gt; 10.1.2.151 port 53
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 <span class="preprocessor"># RDR</span>
<a name="l00269"></a>00269 <span class="preprocessor"></span><span class="preprocessor"># Translate outgoing ftp control connections to send them to localhost</span>
<a name="l00270"></a>00270 <span class="preprocessor"></span><span class="preprocessor"># for proxying with ftp-proxy(8) running on port 8021.</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span>rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 port 8021
<a name="l00272"></a>00272 &lt;/pre&gt;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 &lt;p&gt;In <span class="keyword">this</span> example, a NAT gateway is <span class="keyword">set</span> up to translate <span class="keyword">internal</span> addresses
<a name="l00275"></a>00275 <span class="keyword">using</span> a pool of <span class="keyword">public</span> addresses (192.0.2.16/28) and to redirect incoming
<a name="l00276"></a>00276 web server connections to a group of web servers on the internal network.&lt;/p&gt;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 &lt;pre&gt;
<a name="l00279"></a>00279 <span class="preprocessor"># NAT LOAD BALANCE</span>
<a name="l00280"></a>00280 <span class="preprocessor"></span><span class="preprocessor"># Translate outgoing packets' source addresses using an address pool.</span>
<a name="l00281"></a>00281 <span class="preprocessor"></span><span class="preprocessor"># A given source address is always translated to the same pool address by</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span><span class="preprocessor"># using the source-hash keyword.</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span>nat on $ext_if inet from any to any -&gt; 192.0.2.16/28 source-hash
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="preprocessor"># RDR ROUND ROBIN</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span><span class="preprocessor"># Translate incoming web server connections to a group of web servers on</span>
<a name="l00287"></a>00287 <span class="preprocessor"></span><span class="preprocessor"># the internal network.</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span>rdr on $ext_if proto tcp from any to any port 80 \
<a name="l00289"></a>00289       -&gt; { 10.1.2.155, 10.1.2.160, 10.1.2.161 } round-robin
<a name="l00290"></a>00290 &lt;/pre&gt;
<a name="l00291"></a>00291 &lt;/td&gt;
<a name="l00292"></a>00292 &lt;/tr&gt;
<a name="l00293"></a>00293 &lt;/<a class="code" href="classtable.html">table</a>&gt;
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Tue Dec 8 14:10:07 2009 for ComixWall ISG Administration Interface by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.4 </small></address>
</body>
</html>
